---
title: "notes"
author: "Taylor R. Brown"
date: "12/15/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

Ideally (why, though?) the posterior predictive distribution

$$
p(y_{t+1} \mid y_{1:t}) = \int p(y_{t+1} \mid y_{1:t}, \theta)p(\theta \mid y_{1:t}) d \theta = \int p(y_{t+1} \mid y_{1:t}, \theta) \frac{p( y_{1:t} \mid \theta)}{p(y_{1:t})}p(\theta) d \theta 
$$

Instead 
$$
g(y_{t+1} \mid y_{1:t}) = \int p(y_{t+1} \mid y_{1:t}, \theta) p(\theta ) d \theta = \int p(y_{t+1} \mid y_{1:t}, \theta) p(\theta ) d \theta
$$

## difference in expectations

As 

$$
p(y_{t+1} \mid y_{1:t}) - g(y_{t+1} \mid y_{1:t}) = \mathbb{E}_{\theta}\left[ p(y_{t+1} \mid y_{1:t}, \theta)  \left( 1 - \frac{ p( y_{1:t} \mid \theta) }{ p(y_{1:t}) } \right) \right]
$$

Maybe the difference in these expectations itself can be monitored!

Let's say we're interested in some function $f$. Under certain conditions
\begin{align*}
\mathbb{E}_{p(y_{t+1} \mid y_{1:t})}[f] - \mathbb{E}_{g(y_{t+1} \mid y_{1:t})}[f] 
&= \int f(y_{t+1}) \mathbb{E}_{\theta}\left[ p(y_{t+1} \mid y_{1:t}, \theta)  \left( 1 - \frac{ p( y_{1:t} \mid \theta) }{ p(y_{1:t}) } \right) \right] d y_{t+1} \\
&= 
 \mathbb{E}_{\theta}\left[\int f(y_{t+1}) p(y_{t+1} \mid y_{1:t}, \theta) d y_{t+1}  \left( 1 - \frac{ p( y_{1:t} \mid \theta) }{ \hat{p}(y_{1:t}) } \right) \right] 
\end{align*}

## Our approach

$$
\int f(y_{t+1}) p(y_{t+1} \mid y_{1:t}, \theta) d y_{t+1} = \mathbb{E}\left[ f(y_{t+1}) \mid y_{1:t}, \theta \right] = \mathbb{E}\left[\mathbb{E}\{ f(y_{t+1}) \mid x_t  \} \mid y_{1:t}, \theta \right] = n^{-1}\sum_{i=1}^nh(x_t^i, y_{1:t}, \theta) = g_1(\theta, y_{1:t})
$$

$$
 \left( 1 - \frac{ p( y_{1:t} \mid \theta) }{ \hat{p}(y_{1:t}) } \right) = g_2(\theta, y_{1:t})
$$

<!-- \begin{align*} -->
<!-- \mathbb{E}_{\theta}\left[\int f(y_{t+1}) p(y_{t+1} \mid y_{1:t}, \theta) d y_{t+1}  \left( 1 - \frac{ p( y_{1:t} \mid \theta) }{ \hat{p}(y_{1:t}) } \right) \right]  -->
<!-- &= -->
<!-- \mathbb{E}_{\theta}\left[\int f(y_{t+1}) p(y_{t+1} \mid y_{1:t}, \theta) d y_{t+1}  \left( 1 - \frac{ p( y_{1:t} \mid \theta) }{ \hat{p}(y_{1:t}) } \right) \right]  -->
<!-- \end{align*} -->

